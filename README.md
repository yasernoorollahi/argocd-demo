# argocd-demo

This repository contains a minimal ArgoCD demo application with an
Elasticsearch manifest targeted for Elastic Cloud on Kubernetes (ECK).

## Overview

This project demonstrates deploying an Elasticsearch cluster using the
ECK (Elastic Cloud on Kubernetes) operator. The provided manifests
illustrate a small, stateful Elasticsearch deployment with TLS enabled
and minimal resource requests suitable for development or demonstration
clusters.

## Contents

- `app/deployment.yaml` — (optional) example application deployment
- `app/elasticsearch.yml` — Elasticsearch CR manifest for ECK (8.17.2)

## Prerequisites

- A running Kubernetes cluster (v1.27+ recommended).
- `kubectl` configured to talk to the cluster.
- The ECK operator installed in the cluster to manage Elasticsearch CRs.

Install ECK (operator) quick example:

```bash
kubectl apply -f https://download.elastic.co/downloads/eck/2.17.0/crds.yaml
kubectl apply -f https://download.elastic.co/downloads/eck/2.17.0/operator.yaml
```

Replace the version above with the desired ECK operator version.

## Deploy Elasticsearch (example)

Apply the provided Elasticsearch manifest using `kubectl`:

```bash
kubectl apply -f app/elasticsearch.yml
```

This manifest creates a single-node Elasticsearch cluster (ECK
`Elasticsearch` custom resource) configured with:

- Elasticsearch version: 8.17.2
- TLS enabled (self-signed certs generated by ECK)
- Resources: 1Gi memory request/limit, 20m CPU
- Storage: 1Gi PersistentVolumeClaim

## Verify

Check the Elasticsearch resource and related Kubernetes objects:

```bash
kubectl get elasticsearch -n default
kubectl get pods -l common.k8s.elastic.co/type=elasticsearch -n default
kubectl get statefulsets -n default
kubectl get secrets -n default | grep elastic
```

ECK will generate TLS certificates and secrets automatically; you can
inspect them with `kubectl get secret` and `kubectl describe secret`.

## TLS and Access

The example uses HTTP TLS with a self-signed certificate generated by
ECK. For production use, replace with CA-signed certs or integrate the
operator with your PKI.

To access Elasticsearch from outside the cluster, create a Service or
ingress in front of the cluster, or use `kubectl port-forward` to a
pod for short-lived access.

Example port-forward (for local testing):

```bash
POD=$(kubectl get pods -l common.k8s.elastic.co/type=elasticsearch -n default -o name | head -n1)
kubectl port-forward -n default $POD 9200:9200
```

Then access Elasticsearch at `https://localhost:9200` (TLS).

## Resource Notes

The manifest in `app/elasticsearch.yml` requests 1Gi memory and 20m CPU
and provisions a 1Gi PVC. These settings are minimal and intended for
development only. For production you should increase memory, CPU, and
storage according to your workload and JVM heap sizing best practices.

## Cleanup

To remove the Elasticsearch resource and associated Kubernetes
objects created by ECK:

```bash
kubectl delete -f app/elasticsearch.yml
```

If you installed the ECK operator for testing and want to remove it:

```bash
kubectl delete -f https://download.elastic.co/downloads/eck/2.17.0/operator.yaml
kubectl delete -f https://download.elastic.co/downloads/eck/2.17.0/crds.yaml
```

## References

- ECK documentation: https://www.elastic.co/guide/en/cloud-on-k8s/current/index.html
- Elasticsearch on Kubernetes: https://www.elastic.co/guide/en/elasticsearch/reference/current/
